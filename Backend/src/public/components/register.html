<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký - BookStore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            /* Dùng chung hình nền với trang login để đồng bộ */
            background-image: url('https://images.unsplash.com/photo-1507842217121-9e963db99941?q=80&w=2000&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            min-height: 100vh; /* Dùng min-height để tránh lỗi khi form dài ra */
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            padding: 20px 0; /* Thêm đệm trên dưới cho mobile */
        }
        
        .register-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }

        .register-header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .btn-register {
            background-color: #e67e22; /* Màu cam tạo sự khác biệt cho nút Đăng ký */
            border: none;
            padding: 10px;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-register:hover {
            background-color: #d35400;
        }

        .form-floating label {
            color: #666;
        }
        .rollback {
            display: flex;
            margin-top: 15px;
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-5">
                <div class="card register-card">
                    <div class="register-header">
                        <h3><i class="fas fa-user-plus me-2"></i>Đăng Ký Thành Viên</h3>
                        <p class="mb-0 fs-6">Tham gia cộng đồng yêu sách ngay hôm nay</p>
                    </div>

                    <div class="card-body p-4">
                        <form>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="fullName" placeholder="Nguyễn Văn A" required>
                                <label for="fullName">UserName</label>
                            </div>

                            

                            <div class="form-floating mb-3">
                                <input type="password" class="form-control" id="regPassword" placeholder="Password" required>
                                <label for="regPassword">Mật khẩu</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" required>
                                <label for="confirmPassword">Nhập lại mật khẩu</label>
                            </div>

                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="agreeTerm" required>
                                <label class="form-check-label small text-secondary" for="agreeTerm">
                                    Tôi đồng ý với <a href="#" class="text-decoration-none">Điều khoản sử dụng</a> và <a href="#" class="text-decoration-none">Chính sách bảo mật</a>.
                                </label>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-register btn-lg text-white">Đăng Ký Tài Khoản</button>
                            </div>
                            <div>
                                <a href="../index.html" class="rollback">Quay lại </a>
                            </div>
                            <div class="text-center mt-4">
                                <span class="small text-secondary">Bạn đã có tài khoản? </span>
                                <a href="login.html" class="text-decoration-none fw-bold text-primary">Đăng nhập ngay</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // BẮT SỰ KIỆN KHI NGƯỜI DÙNG NHẤN NÚT ĐĂNG KÝ (HOẶC ENTER)
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        
        // 1. Ngăn không cho trang web load lại (Mặc định của Form HTML)
        e.preventDefault(); 

        // 2. Lấy dữ liệu từ các ô input
        // .value dùng để lấy những gì người dùng gõ vào
        const usernameInput = document.getElementById('fullName').value; 
        const passwordInput = document.getElementById('regPassword').value;
        const confirmPassInput = document.getElementById('confirmPassword').value;
        
        // 3. Kiểm tra phía Client (Validate)
        if (passwordInput !== confirmPassInput) {
            alert("Mật khẩu nhập lại không khớp!");
            return; // Dừng lại, không gửi đi đâu cả
        }

        // 4. Gửi dữ liệu sang Backend (Gọi API)
        try {
            const response = await fetch('http://localhost:5001/api/user/sign-up', {
                method: 'POST', // Phương thức tạo mới
                headers: {
                    'Content-Type': 'application/json' // Báo cho server biết mình gửi JSON
                },
                // Chuyển đổi dữ liệu sang chuỗi JSON để gửi
                body: JSON.stringify({
                Username: usernameInput, // Gửi giá trị của usernameInput vào cái hộp tên là Username
                PassWord: passwordInput  // Gửi giá trị của passwordInput vào cái hộp tên là PassWord
})
            });

            // 5. Nhận phản hồi từ Server
            const data = await response.json();

            // 6. Xử lý kết quả
            if (data.status === 'OK') {
                alert("Đăng ký thành công! Hãy đăng nhập.");
                window.location.href = 'login.html'; // Chuyển sang trang đăng nhập
            } else {
                // Backend trả về lỗi (ví dụ: Tài khoản đã tồn tại)
                alert(data.message); 
            }

        } catch (error) {
            console.error("Lỗi:", error);
            alert("Không thể kết nối đến Server (Cổng 5001). Hãy kiểm tra lại Backend.");
        }
    });
</script>
</body>
</html>