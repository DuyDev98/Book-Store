<div class="topbar d-flex align-items-center">
  <div class="container d-flex justify-content-between py-2">
    <div class="top-left text-white small d-flex align-items-center flex-wrap">
      <span><i class="bi bi-telephone-fill me-1"></i> 0989. 988 988</span>
      <span class="mx-2">|</span>
      <span><i class="bi bi-envelope-fill me-1"></i> hotro@bookstore.com</span>
    </div>

    <div class="top-right">
       <button class="btn-topbar me-3 login-btn-register"><h6>ĐĂNG KÝ</h6></button>
       <button class="btn-topbar login-btn-login"><h6>ĐĂNG NHẬP</h6></button>
    </div>
  </div>
</div>

<header>
  <div class="container d-flex justify-content-between align-items-center">
    <a href="index.html" class="btn-logo">
      <img src="images/tenweb.png" alt="BookStore Logo" height="50">
    </a>
    
  <div class="search-box position-relative d-flex">
    <input type="text" id="search-input" class="form-control" placeholder="Tìm kiếm sách..." autocomplete="off"/>
    
    <button class="btn" id="search-btn"><i class="bi bi-search"></i> Tìm kiếm</button>

      <div id="suggestion-box" class="list-group position-absolute start-0 end-0 shadow overflow-auto" 
         style="top: 100%; z-index: 1000; max-height: 400px; display: none;">
      </div>
  </div>

    <a href="pages/cart.html" class="btn-cart position-relative text-dark text-decoration-none">
      <img src="logo/cart.png" alt="Giỏ hàng" height="30">
      <span id="cart-badge" 
            class="position-absolute bg-danger rounded-circle border border-white"
            style="top: 0; right: 0; width: 10px; height: 10px; display: none;">
      </span>
    </a>
  </div>
</header>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const suggestionBox = document.getElementById('suggestion-box');
    let debounceTimer;

    searchInput.addEventListener('input', function() {
        const keyword = this.value.trim();
        
        // 1. Xóa gợi ý nếu ô tìm kiếm trống
        if (keyword.length === 0) {
            suggestionBox.style.display = 'none';
            suggestionBox.innerHTML = '';
            return;
        }

        // 2. Debounce: Đợi 300ms sau khi ngừng gõ mới tìm (tránh spam server)
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            fetchSuggestions(keyword);
        }, 300);
    });

    // Hàm gọi API lấy dữ liệu
    async function fetchSuggestions(keyword) {
        try {
            // Thay đổi đường dẫn này theo Router Node.js của bạn
            // Ví dụ: /api/books/search-suggest?q=...
            const response = await fetch(`/search/suggest?q=${encodeURIComponent(keyword)}`);
            const books = await response.json();
            
            renderSuggestions(books);
        } catch (error) {
            console.error('Lỗi tìm kiếm:', error);
        }
    }

    // Hàm vẽ HTML ra giao diện
    function renderSuggestions(books) {
        if (books.length === 0) {
            suggestionBox.style.display = 'none';
            return;
        }

        // Tạo HTML sử dụng class của Bootstrap
        const html = books.map(book => `
            <a href="/books/detail/${book.id}" class="list-group-item list-group-item-action d-flex align-items-center suggestion-item">
                <img src="${book.image}" alt="${book.title}" class="suggestion-img border rounded">
                <div class="flex-grow-1 ms-2">
                    <h6 class="mb-0 text-dark">${highlightKeyword(book.title)}</h6>
                    <small class="text-muted">${book.author}</small>
                    <div class="text-danger fw-bold small">${formatCurrency(book.price)}</div>
                </div>
            </a>
        `).join('');

        suggestionBox.innerHTML = html;
        suggestionBox.style.display = 'block';
    }

    // Hàm phụ: Bôi đậm từ khóa
    function highlightKeyword(text) {
        const keyword = searchInput.value.trim();
        const regex = new RegExp(`(${keyword})`, 'gi');
        return text.replace(regex, '<span class="bg-warning">$1</span>');
    }

    // Hàm phụ: Format tiền tệ VNĐ
    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }

    // 3. Ẩn gợi ý khi click ra ngoài
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !suggestionBox.contains(e.target)) {
            suggestionBox.style.display = 'none';
        }
    });
});
</script>